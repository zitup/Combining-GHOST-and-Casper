## 概率活性

在本节中，我们根据⼀些假设证明[第 4 节](Main-Protocol-Gasper.md)中的主要协议 Gasper 的概率活性。我们的证明由以下步骤组成，基本上就是[定理 6.1](Plausible-Liveness.md#6.1)证明的主要思想：

1. （假设第⼀个插槽后导致权重较⾼）在“良好”条件下（例如拥有⾜够多的诚实验证者、同步条件等来形式化），诚实验证者在第⼀个插槽后很有可能找到具有⾼权重的区块。
2. （第⼀个插槽之后的⾼权重导致⾼合理性概率）如果我们在⼀个插槽之后得到⼀个⾼权重的区块，那么它与竞争对⼿的权重“差异”可能会在整个时期内增加，这意味着这个区块（或后代）很可能被合理化。
3. （⾼合理性概率导致⾼最终确定概率）如果每个时期都有可能证明⼀个区块，那么随着 $n$ 的增加，很可能至少有一个区块会在 $n$ 个时期的延伸中最终确定。

这种划分不仅仅是组织上的；它还将假设封装到论证的不同部分，这样即使假设发⽣变化，每个部分仍然正确。例如，对应于第 3 项的主要定理，定理 7.5，没有做出任何同步假设，只依赖于区块被证明的概率 $p$（尽管考虑到前面的部分，可能需要同步假设来限制 $p$）。此外，我们在第⼆部分中假设（就像我们在附录 B 中的模拟中所做的那样）所有验证者都拥有平等的权益，⽽第三部分则不是这样。

本节是最复杂且依赖于参数的部分：一方面，由于证明考虑延迟，当前计划实现的以太坊 2.0 实际上回避了分析的重要部分（参见第 8.4 节）；此外，边界假设每个验证者的权益相等，这可能是也可能不是一个有用的假设，具体取决于外部因素。然而，对“纯”协议进行分析仍然是值得的，因为这里的证明策略（例如使用[集中不等式](https://zh.wikipedia.org/wiki/%E9%9B%86%E4%B8%AD%E4%B8%8D%E7%AD%89%E5%BC%8F)）非常适用于所有这些潜在的基于插槽的权益证明方法，并且我们相信我们的分析抓住了这些方法在概率上发挥作用的核心。事实上，诸如上述证明考虑延迟之类的“补丁”的存在主要是因为针对纯协议的攻击类型，因此，即使实际的实施避开了这些攻击，对于建立直觉来应对这些攻击也是有用的。因此，本节的主要价值是作为设计概率性实时协议（例如 Gasper）所涉及的分析的概念验证，而不是实际实现的数学保证。

### 7.1 第⼀个插槽后的⾼权重 - 模棱两可的游戏

我们对模棱两可的游戏的定义如下：

1. 游戏由 $(V, a, ϵ1, ϵ2)$ 参数化，其中 $V$ 是⼀组验证器， $(a, ϵ1, ϵ2)$ 是参数化⽹络/同步条件的实数（为了便于阅读，我们将详细信息推到附录）。
2. 与 Gasper ⼀样， $|V| = N$，每个 $V ∈ V$ 都有固定的权益 $w(V)$。我们假设总权益为 $N$（因此平均权益为 1），诚实验证者的总权益⾄少为 $2N/3$。
3. 有 2 个选项可供投票，我们简称为 $O$<sub>$1$</sub> 和 $O$<sub>$2$</sub> 。这些是 Gasper 中对 2 个冲突区块进⾏投票的抽象概念，⽽“区块”的概念不包含在这个模棱两可的游戏中。如果 $O$<sub>$1$</sub> 或 $O$<sub>$2$</sub> 获得⾄少 $2N/3$ 权益价值的选票，我们（即诚实的验证者）获胜，否则我们失败（即我们处于模棱两可的状态）。请注意，这相当于游戏结束后两个选择之间存在 $N/3$ 的权益差异。

模棱两可的游戏旨在捕捉 Gasper 的想法，即在⼀个插槽上只有 2 个选择。⼤多数必要的活性假设都被编码到游戏中，以便本节中的其他活性结果尽可能独⽴。

在附录 B 中，我们充实了模棱两可游戏的细节，并用三种机制（悲观机制、乐观机制和介于两者之间的机制）进行了模棱两可游戏的模拟。主要思想是，在“合理”条件 $(V、a、 ϵ1、ϵ2 )$ 下，我们很有可能在第⼀个插槽之后赢得游戏，这意味着我们应该预期 Gasper 中的⼀对在第⼀个插槽之后会拥有价值 $2N/3$ 的权益来⽀持。

从总体上看，对于其余的概率活性，我们唯⼀需要的就是我们以某个概率 $r$ “赢得” 模棱两可的游戏（具体来说，在第⼀个插槽之后，拥有⼀个⽐第⼆好的选择具有更多证明的区块），并且更⾼的 $r$ 增加了定理 7.4 中区块被证明的保证。从实际⽬的来看，附录中的⼯作似乎在同步性不太强或不太弱的情况下，80% 左右的 $r$ 似乎是⼀个合理的启发式⽅法，⽽且这已经假设了⼀个⾮常糟糕的情况，即接近 $1/3$ 的验证者是不诚实。

**备注：** 显然，重复博弈的概念可以推⼴，类似的博弈也可⽤于研究其他权益证明模型。有许多⽅向（诚实验证者的协议、由除均匀分布以外的其他东西建模的延迟等）可能对未来的⼯作有研究价值，但对于我们论⽂的⽬的来说可能太分散注意⼒。

### 7.2 第⼀个插槽后的⾼权重导致合理

在本节中，我们重点关注第 $j$ 个时期 $[T, T + C]$，其中 $T = jC$。令 $S = N/C$。我们定义以下⼀组假设，我们称之为 $A(ϵ)$：

- ⽹络从时间 $T = jC$ 开始为 (1/2)-同步；
- 每个验证者有 1 个权益；
- 拜占庭验证者的总数等于 $N/3−Cϵ$，这意味着每个插槽委员会中拜占庭验证者的平均数量为 $S/3-ϵ$。

对于每个 $i ∈ \{0, 1, . . . , C − 1\}$，定义 $h$<sub>$i$</sub> 为插槽 $jC + i$ 中保证诚实证明者的数量， $b$<sub>$i$</sub> 为插槽中不诚实证明者的数量。设 $S = N/C$，则对于所有 $i$， $h$<sub>$i$</sub>$+b$<sub>$i$</sub>$=S$。我们使⽤普遍存在的集中不等式，证明诚实/不诚实证明者的分布不应偏离命题 7.2 中的期望太多：

**命题 7.1。** 略。

**命题 7.2。** 略。

**引理 7.3。** 略。

**定理 7.4。** 略。

### 7.3 概率合理导致概率最终确定性

**定理 7.5。** 略。

备注（与可信活性的关系）。从技术上来说，我们可能感觉可以从概率活性中“免费”获得可信活性。那么为什么我们
在本⽂中要分别处理它们呢？

⾸先，可信活性是 Gasper 协议规则的直接结果，需要很少的假设，⽽概率活性则依赖于概率假设（例如⽹络同步），并且协议稍有变化就会变得更加脆弱。特别是，我们的概率活性处理做出了⾮常强烈的假设，即所有验证者都具有相同的利害关系。因此，我们选择单独展⽰可信活性，以强调即使尽管这些假设在“现实⽣活中”⽆法得到满⾜，但可信活性仍然存在。

另⼀⽅⾯，可信活性的重点是“诚实的验证者永远不会被要求⾃愿削减⾃⼰以继续的协议”和对概率活性的强调是“新的区块可能很快就会被证明/最终确定；”这些是不同的要点。
